# Changelog 2025-08-26

## Summary

Завершение Phase 0 (опорные контракты) и ключевые задачи Phase 1 (надёжность):

- Потокобезопасная загрузка LLM (gate #1)
- Bi-directional config schema test (gate #2)
- Аудит ENV overrides (метрика + лог)
- Валидации и нормализация конфигурации (top_p, max_output_tokens, n_gpu_layers)
- Расширение error taxonomy (config-out-of-range, config-invalid)
- Формализация порога EventBus overhead (<2%) в Perf.md


## Added

- Thread safety для LLMModule: RLock + double-checked loading.
- Bi-dir schema тест `test_config_bidirectional_schema` (registry ↔ runtime).
- ENV override аудит: метрика `env_override_total{path}` + структурированный лог.
- Метрика `config_validation_errors_total{path,code}`.
- Глобальные валидации конфигурации (top_p, max_output_tokens) + нормализация n_gpu_layers.
- Error types: `config-out-of-range`, `config-invalid`.
- Тесты: `test_config_env_overrides_metric`, `test_config_validation_bounds`.

## Improved

- Конфиг загрузка: централизация ENV обработки и аудит.
- Надёжность: исключены тихие ошибки параметров генерации на старте.
- Perf.md: формализован EventBus overhead threshold и процедура подтверждения.
- Тестовое покрытие: 47 passed (+ новые проверки валидации/метрик).

## Documentation

- `.instructions.md` обновлён: все Phase 1 цели отмечены.
- Perf.md дополнен разделом EventBus overhead threshold.
- Error taxonomy (ADR-0006) расширена (коды в коде и тестах; ADR дифф pending при необходимости описания причин).

## Internal Notes

- ENV значения маскируются в логах (`value=***`).
- Конфиг ошибки агрегируются в одно исключение с перечислением путей.
- Следующий этап: переход к Phase 2 (UI Shell scaffold + streaming API) после фикса данного отчёта.

