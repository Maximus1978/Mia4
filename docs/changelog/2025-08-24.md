# Changelog — 2025-08-24

## Summary

Фокус дня: завершение минимального пакета перед модульным рефакторингом и фиксация новых целей спринта.

## Key Changes

- Перф инфраструктура: perf_probe переработан (event-based tokens, gpu_auto, long_gpuauto, warmup, множественные long сценарии, tps/p95/p95_ratio регрессии).
- Добавлен тест `test_perf_regression_guard` (pytest @performance) — читает perf_probe.json и валидирует отсутствие регрессий/SLA нарушений.
- Добавлен optional judge модель (`phi-3.5-mini-judge`) с lazy загрузкой; idle sweep уже поддержан.
- Добавлен baseline snapshot: `reports/baseline/perf_probe_2025-08-24.json` (исключение в .gitignore для baseline каталога).
- Обновлён `Perf.md`: раздел Decode Latency Distribution + Deferred/Backlog (FMHA, аномалия 12 слоёв, CI_PERF и др.).
- Обновлён `.instructions.md`: старый спринт архивирован; новая секция "Цели следующего спринта: Модульный рефакторинг ядра" (S1–S7, KPI, риски, тест‑план).
- В `.gitignore` разрешено версионирование baseline JSON (reports/baseline/*).

## Deferred (explicit today)

Перенесены: FMHA rebuild, анализ n_gpu_layers=12, CI_PERF, histogram latency, formula T, cpu_baseline сценарий в perf_probe, advanced resource policies, расширенная capability матрица, encryption/ACL.

## Risks / Mitigation

- Риск несовместимости будущего schema_version — добавим миграционный слой в S1.
- Потенциальные циклические импорты после дробления конфигов — планируется тест import graph.

## Next Sprint Entry Point

Начинаем S1: выделение под‑схем конфигурации (LLMConfig, PerfConfig, RAGConfig, MemoryConfig, ObservabilityConfig, OptionalModelsConfig) + schema_version и мигратор старого YAML.

## Metrics Snapshot (per perf_probe latest)

- short_gpu6 tps: 5.848
- long_gpu6 p95_decode_ms: 167.52
- long_gpuauto p95_decode_ms: 56.57
- Регрессий: 0, SLA issues: 0

## Validation

- Все существующие тесты + новый regression guard прошли локально.
- Baseline perf snapshot зафиксирован для последующих сравнений.

