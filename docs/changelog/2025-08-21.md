# 2025-08-21

Первичная фиксация ключевых изменений (инициализация changelog).

## Added

- Манифест `gpt-oss-20b-q4km` (primary) с checksum и расширенным context_length=32768.
- Скрипт `scripts/perf_cpu_baseline.py` для замера load_ms / tokens_per_s.
- Скрипт `scripts/perf_tune_cpu.py` (свип по `n_threads` / `n_batch`, вывод JSON + markdown таблица).
- Событие `ReasoningPresetApplied` в спецификации Events + пример лог-записи.
- Конфигурационные ключи `llm.primary.n_threads`, `llm.primary.n_batch` в реестр.
- Документация методологии перфома: `docs/ТЗ/Perf.md` (baseline + свип результаты).

## Changed

- Обновлён `llama-cpp-python` → 0.3.16 (для поддержки архитектуры gpt-oss).
- Обновлён `pydantic` до v2 (унифицированы валидаторы, совместимость с loader).
- README: добавлены разделы Performance (baseline + tuning summary).
- `docs/ТЗ/Модели ИИ.md`: актуализирован текущий primary (gpt-oss-20b-q4km), расширена таблица полей манифеста (реализовано vs план).
- `docs/ТЗ/Config-Registry.md`: внесены новые ключи (n_threads, n_batch), обновлён default primary id (оставлен mxfp4 — см. Notes).
- `.instructions.md`: отмечены завершённые шаги 10.1 (CPU baseline) и 10.2 (CPU tuning), добавлена задача сравнения квантов (post-sprint).

## Performance

- CPU baseline (Q4_K_M): load_ms ≈ 2227 ms, tokens/s ≈ 6.56 (54 токенов за 8.2256 s).
- Лучшая свип-комбинация: `n_threads=8`, `n_batch=256` → ≈6.69 tokens/s (+~2%).
- Авто выбор потоков («auto») деградирует скорость на текущем железе.

## Notes

- В `configs/base.yaml` default ещё `gpt-oss-20b-mxfp4` чтобы не ломать существующие тесты; фактически измерения и реальный запуск проводятся на `gpt-oss-20b-q4km`. План: синхронизировать default после:
  1) проверки загрузки MXFP4 в обновлённом рантайме;
  2) сравнительного перф теста (MXFP4 vs Q4_K_M) — задача добавлена в пост-спринт.
- Следующие шаги по перфу: GPU smoke (Step 10.3), scaling (10.4), long context (10.5), aggregate script `perf_probe.py`, CI smoke.
- DEFAULT_COLLECTION гарантированно = `memory` (проверено в base config).

UPDATE 2025-08-22: default синхронизирован на `gpt-oss-20b-q4km` после успешного baseline и отсутствия блокеров по MXFP4.

## Integrity / Rationale

Каждый пункт делает Мию более воспроизводимой (версии + baseline), наблюдаемой (events, perf json), расширяемой (манифест + новые конфиг ключи) и готовой к дальнейшей оптимизации (GPU этапы).
