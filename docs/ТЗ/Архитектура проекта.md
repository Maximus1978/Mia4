# Архитектура проекта

Кратко: модульное ядро + изолированные плагины. Взаимодействие только через события и сервисные интерфейсы ядра.

## Модули

- core — events, config, module loader, model gateway.
- rag — индексация и извлечение.
- emotion — FSM эмоций.
- reflection — nightly анализ и инсайты.
- ui — адаптер UI / websocket.
- voice — STT/TTS (опционально).
- tools — внешние инструментальные вызовы.
- vision (Planned) — обработка изображений.

## Принципы

- Нет прямых импортов между modules/*.
- Модуль может упасть → ядро помечает disabled, остальные продолжают.
- API наружу минимально: WebSocket + REST.

## Поток (см. [[Agent-Loop]])

UserInput → core.events → (emotion|rag) → LLM → post‑process (emotion tone) → output + log → reflection (batched).

## Данные

- SQLite (diary, events, insights).
- Qdrant (векторное хранилище).
- Файлы snapshots (периодические дампы памяти).

## Расширяемость

- Новый модуль = папка + manifest.yaml + init(core) → регистрация подписок.
- Healthcheck обязательный для отключаемости.

## Ошибки / деградация

- Circuit breaker на уровне вызовов сервисов.
- Отсутствие emotion → ответ без модификации стиля.

## Не входит (здесь не описываем)

Детали моделей (см. [[Модели ИИ]]), стратегии retrieval (см. [[RAG]]), эмоциональные состояния (см. [[Эмоциональный слой]]).

