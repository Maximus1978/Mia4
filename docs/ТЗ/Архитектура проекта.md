# Архитектура проекта

Кратко: модульное ядро + изолированные плагины. Взаимодействие только через события и сервисные интерфейсы ядра.

## Модули

- core — events, config, module loader, model gateway.
- rag — индексация и извлечение.
- emotion — FSM эмоций.
- reflection — nightly анализ и инсайты.
- ui — адаптер UI / websocket.
- voice — STT/TTS (опционально).
- tools — внешние инструментальные вызовы.
- ingest (новый) — загрузка и разбор файлов.
- vision (Planned) — обработка изображений (OCR+caption).

## Принципы

- Нет прямых импортов между modules/*.
- Модуль может упасть → ядро помечает disabled, остальные продолжают.
- API наружу минимально: WebSocket + REST.

## Поток (см. [[Agent-Loop]])

UserInput → core.events → (emotion|rag) → LLM → post‑process → output → reflection  
FileUpload → Ingest.FileUploaded → ingest → (vision?) → Ingest.TextReady → rag → Ingest.Indexed

## Данные

- SQLite (diary, events, insights, documents).
- Qdrant (векторное хранилище).
- storage/raw (оригиналы), snapshots (дампы памяти).

## Расширяемость

- Новый модуль = папка + manifest.yaml + init(core).
- ingest добавляет события: Ingest.FileUploaded, Ingest.TextReady, Ingest.Indexed, Ingest.Error.
- vision добавляет: Vision.OCRExtracted, Vision.ImageCaptioned.

## Ошибки / деградация

- Падение ingest: отключена загрузка, остальной функционал активен.
- Падение vision: текстовые документы продолжают индексироваться.

## Не входит

Детали моделей (см. [[Модели ИИ]]), retrieval стратегии (см. [[RAG]]), эмоции (см. [[Эмоциональный слой]]).